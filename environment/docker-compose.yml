services:
  de_workbench:
      build: .
      container_name: hotel_de_workbench
      volumes:
        - ../projects:/workspace/projects
        - ../docs:/workspace/docs
      working_dir: /workspace
      environment:
        - PYTHONUNBUFFERED=1
        - PYTHONPATH=/workspace
  postgres:
    image: postgres:15-alpine
    container_name: de_journey_postgres
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: admin
      POSTGRES_DB: journey_db
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U admin -d journey_db"]
      interval: 5s
      timeout: 5s
      retries: 5

  spark-master:
    image: bitnami/spark:3.5
    environment:
      - SPARK_MODE=master
    ports:
      - "8080:8080"
      - "7077:7077"

  spark-worker:
    image: bitnami/spark:3.5
    environment:
      - SPARK_MODE=worker
      - SPARK_MASTER_URL=spark://spark-master:7077
    depends_on:
      - spark-master

volumes:
  postgres_data:
